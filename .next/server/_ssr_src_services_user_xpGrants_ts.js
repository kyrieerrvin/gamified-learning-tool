"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_ssr_src_services_user_xpGrants_ts";
exports.ids = ["_ssr_src_services_user_xpGrants_ts"];
exports.modules = {

/***/ "(ssr)/./src/services/user/xpGrants.ts":
/*!***************************************!*\
  !*** ./src/services/user/xpGrants.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   buildDedupeKey: () => (/* binding */ buildDedupeKey),\n/* harmony export */   createXpGrant: () => (/* binding */ createXpGrant),\n/* harmony export */   flushQueuedGrants: () => (/* binding */ flushQueuedGrants),\n/* harmony export */   getLocalDateKey: () => (/* binding */ getLocalDateKey),\n/* harmony export */   subscribeToXp: () => (/* binding */ subscribeToXp)\n/* harmony export */ });\n/* harmony import */ var _lib_firebase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/firebase */ \"(ssr)/./src/lib/firebase.ts\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"(ssr)/./node_modules/firebase/firestore/dist/index.mjs\");\n// src/services/user/xpGrants.ts\n/* __next_internal_client_entry_do_not_use__ getLocalDateKey,flushQueuedGrants,createXpGrant,buildDedupeKey,subscribeToXp auto */ \n\nconst getUserIdOrThrow = ()=>{\n    const user = _lib_firebase__WEBPACK_IMPORTED_MODULE_0__.auth.currentUser;\n    if (!user) throw new Error('[XP] No authenticated user');\n    return user.uid;\n};\nconst getLocalDateKey = ()=>{\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0');\n    const day = String(now.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n};\n// Simple offline queue using localStorage\nconst QUEUE_KEY = 'xpGrantQueue';\nconst readQueue = ()=>{\n    try {\n        const raw = localStorage.getItem(QUEUE_KEY);\n        return raw ? JSON.parse(raw) : [];\n    } catch  {\n        return [];\n    }\n};\nconst writeQueue = (items)=>{\n    try {\n        localStorage.setItem(QUEUE_KEY, JSON.stringify(items));\n    } catch  {}\n};\nconst enqueueGrant = (grant)=>{\n    const q = readQueue();\n    q.push(grant);\n    writeQueue(q);\n};\nconst flushQueuedGrants = async ()=>{\n    const items = readQueue();\n    if (!items.length) return;\n    const remaining = [];\n    for (const grant of items){\n        try {\n            await createXpGrant(grant, {\n                skipOfflineQueue: true\n            });\n            console.log('[XP] Flushed queued grant', grant.dedupeKey);\n        } catch (e) {\n            console.warn('[XP] Failed to flush queued grant, keeping in queue', grant.dedupeKey, e);\n            remaining.push(grant);\n        }\n    }\n    writeQueue(remaining);\n};\nif (false) {}\nconst createXpGrant = async (partial, options = {})=>{\n    const userId = getUserIdOrThrow();\n    const localDateKey = partial.localDateKey || getLocalDateKey();\n    const dedupeKey = partial.dedupeKey || buildDedupeKey(userId, partial.sourceType, partial.sourceId, localDateKey);\n    const grant = {\n        userId,\n        sourceType: partial.sourceType,\n        sourceId: partial.sourceId,\n        amount: Math.max(0, Math.floor(partial.amount || 0)),\n        localDateKey,\n        dedupeKey,\n        createdAt: new Date().toISOString()\n    };\n    if (grant.amount <= 0) throw new Error('[XP] Invalid grant amount');\n    const col = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_0__.db, 'gameProgress', userId, 'xpGrants');\n    const ref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(col, dedupeKey);\n    try {\n        const result = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.runTransaction)(_lib_firebase__WEBPACK_IMPORTED_MODULE_0__.db, async (tx)=>{\n            const snap = await tx.get(ref);\n            if (snap.exists()) {\n                return {\n                    created: false\n                };\n            }\n            tx.set(ref, grant);\n            return {\n                created: true\n            };\n        });\n        console.log('[XP] Grant persisted', {\n            dedupeKey,\n            sourceType: grant.sourceType,\n            amount: grant.amount\n        });\n        return {\n            created: result.created,\n            id: dedupeKey\n        };\n    } catch (err) {\n        // Offline or other error: optionally queue\n        if (!options.skipOfflineQueue && typeof navigator !== 'undefined' && !navigator.onLine) {\n            enqueueGrant(grant);\n            console.warn('[XP] Offline, queued grant', dedupeKey);\n            throw new Error('[XP] Queued (offline)');\n        }\n        throw err;\n    }\n};\nconst buildDedupeKey = (userId, sourceType, sourceId, localDateKey)=>{\n    // Quests should be idempotent per day, levels should be idempotent forever\n    if (sourceType === 'quest') {\n        return `${userId}:quest:${sourceId}:${localDateKey || getLocalDateKey()}`;\n    }\n    return `${userId}:level:${sourceId}`;\n};\nconst subscribeToXp = (onChange)=>{\n    const userId = getUserIdOrThrow();\n    const col = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_lib_firebase__WEBPACK_IMPORTED_MODULE_0__.db, 'gameProgress', userId, 'xpGrants');\n    const qAll = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)(col, (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.orderBy)('createdAt', 'desc'));\n    return (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.onSnapshot)(qAll, (snap)=>{\n        let lifetimeTotal = 0;\n        let todayQuestTotal = 0;\n        const todayKey = getLocalDateKey();\n        const grants = [];\n        snap.forEach((d)=>{\n            const data = d.data();\n            const rec = {\n                userId: data.userId,\n                sourceType: data.sourceType,\n                sourceId: data.sourceId,\n                amount: data.amount,\n                localDateKey: data.localDateKey,\n                dedupeKey: data.dedupeKey || d.id,\n                createdAt: data.createdAt\n            };\n            grants.push(rec);\n            lifetimeTotal += rec.amount;\n            if (rec.sourceType === 'quest' && rec.localDateKey === todayKey) {\n                todayQuestTotal += rec.amount;\n            }\n        });\n        onChange({\n            lifetimeTotal,\n            todayQuestTotal,\n            grants\n        });\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVVBLENBQUMyRSxNQUFNLENBQUNYO1FBQ3hCLElBQUlZLGdCQUFnQjtRQUNwQixJQUFJQyxrQkFBa0I7UUFDdEIsTUFBTUMsV0FBV3JFO1FBQ2pCLE1BQU1zRSxTQUEwQixFQUFFO1FBQ2xDZixLQUFLZ0IsT0FBTyxDQUFDLENBQUNDO1lBQ2IsTUFBTUMsT0FBT0QsRUFBRUMsSUFBSTtZQUNuQixNQUFNQyxNQUFxQjtnQkFDMUJsQyxRQUFRaUMsS0FBS2pDLE1BQU07Z0JBQ25CRyxZQUFZOEIsS0FBSzlCLFVBQVU7Z0JBQzNCQyxVQUFVNkIsS0FBSzdCLFFBQVE7Z0JBQ3ZCQyxRQUFRNEIsS0FBSzVCLE1BQU07Z0JBQ25CSixjQUFjZ0MsS0FBS2hDLFlBQVk7Z0JBQy9CUixXQUFXd0MsS0FBS3hDLFNBQVMsSUFBSXVDLEVBQUVaLEVBQUU7Z0JBQ2pDWCxXQUFXd0IsS0FBS3hCLFNBQVM7WUFDMUI7WUFDQXFCLE9BQU83QyxJQUFJLENBQUNpRDtZQUNaUCxpQkFBaUJPLElBQUk3QixNQUFNO1lBQzNCLElBQUk2QixJQUFJL0IsVUFBVSxLQUFLLFdBQVcrQixJQUFJakMsWUFBWSxLQUFLNEIsVUFBVTtnQkFDaEVELG1CQUFtQk0sSUFBSTdCLE1BQU07WUFDOUI7UUFDRDtRQUNBb0IsU0FBUztZQUFFRTtZQUFlQztZQUFpQkU7UUFBTztJQUNuRDtBQUNELEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9lcnZpbnJhcGhhZWxhbGJhL0Rlc2t0b3AvWDQyMC9zcmMvc2VydmljZXMvdXNlci94cEdyYW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvc2VydmljZXMvdXNlci94cEdyYW50cy50c1xuJ3VzZSBjbGllbnQnO1xuXG5pbXBvcnQgeyBkYiwgYXV0aCB9IGZyb20gJ0AvbGliL2ZpcmViYXNlJztcbmltcG9ydCB7IGNvbGxlY3Rpb24sIGRvYywgb25TbmFwc2hvdCwgcXVlcnksIHdoZXJlLCBydW5UcmFuc2FjdGlvbiwgZ2V0RG9jcywgVGltZXN0YW1wLCBvcmRlckJ5IH0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJztcblxuZXhwb3J0IHR5cGUgWHBTb3VyY2VUeXBlID0gJ3F1ZXN0JyB8ICdsZXZlbCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgWHBHcmFudFJlY29yZCB7XG5cdHVzZXJJZDogc3RyaW5nO1xuXHRzb3VyY2VUeXBlOiBYcFNvdXJjZVR5cGU7XG5cdHNvdXJjZUlkOiBzdHJpbmc7IC8vIHF1ZXN0SWQgb3IgYSBzdGFibGUgbGV2ZWwga2V5IGxpa2UgZ2FtZVR5cGU6c2VjdGlvbjpsZXZlbFxuXHRhbW91bnQ6IG51bWJlcjsgLy8gcG9zaXRpdmUgaW50ZWdlciBvbmx5XG5cdGxvY2FsRGF0ZUtleTogc3RyaW5nOyAvLyBZWVlZLU1NLUREIChkZXZpY2UtbG9jYWwpXG5cdGRlZHVwZUtleTogc3RyaW5nOyAvLyB1bmlxdWUgcGVyIHVzZXIrZXZlbnQgKGRvYyBpZClcblx0Y3JlYXRlZEF0OiBzdHJpbmc7IC8vIElTTyBzdHJpbmdcbn1cblxuY29uc3QgZ2V0VXNlcklkT3JUaHJvdyA9ICgpOiBzdHJpbmcgPT4ge1xuXHRjb25zdCB1c2VyID0gYXV0aC5jdXJyZW50VXNlcjtcblx0aWYgKCF1c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ1tYUF0gTm8gYXV0aGVudGljYXRlZCB1c2VyJyk7XG5cdHJldHVybiB1c2VyLnVpZDtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRMb2NhbERhdGVLZXkgPSAoKTogc3RyaW5nID0+IHtcblx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblx0Y29uc3QgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xuXHRjb25zdCBtb250aCA9IFN0cmluZyhub3cuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XG5cdGNvbnN0IGRheSA9IFN0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpO1xuXHRyZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YDtcbn07XG5cbi8vIFNpbXBsZSBvZmZsaW5lIHF1ZXVlIHVzaW5nIGxvY2FsU3RvcmFnZVxuY29uc3QgUVVFVUVfS0VZID0gJ3hwR3JhbnRRdWV1ZSc7XG5cbmNvbnN0IHJlYWRRdWV1ZSA9ICgpOiBYcEdyYW50UmVjb3JkW10gPT4ge1xuXHR0cnkge1xuXHRcdGNvbnN0IHJhdyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFFVRVVFX0tFWSk7XG5cdFx0cmV0dXJuIHJhdyA/IEpTT04ucGFyc2UocmF3KSA6IFtdO1xuXHR9IGNhdGNoIHtcblx0XHRyZXR1cm4gW107XG5cdH1cbn07XG5cbmNvbnN0IHdyaXRlUXVldWUgPSAoaXRlbXM6IFhwR3JhbnRSZWNvcmRbXSkgPT4ge1xuXHR0cnkge1xuXHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKFFVRVVFX0tFWSwgSlNPTi5zdHJpbmdpZnkoaXRlbXMpKTtcblx0fSBjYXRjaCB7fVxufTtcblxuY29uc3QgZW5xdWV1ZUdyYW50ID0gKGdyYW50OiBYcEdyYW50UmVjb3JkKSA9PiB7XG5cdGNvbnN0IHEgPSByZWFkUXVldWUoKTtcblx0cS5wdXNoKGdyYW50KTtcblx0d3JpdGVRdWV1ZShxKTtcbn07XG5cbmV4cG9ydCBjb25zdCBmbHVzaFF1ZXVlZEdyYW50cyA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0Y29uc3QgaXRlbXMgPSByZWFkUXVldWUoKTtcblx0aWYgKCFpdGVtcy5sZW5ndGgpIHJldHVybjtcblx0Y29uc3QgcmVtYWluaW5nOiBYcEdyYW50UmVjb3JkW10gPSBbXTtcblx0Zm9yIChjb25zdCBncmFudCBvZiBpdGVtcykge1xuXHRcdHRyeSB7XG5cdFx0XHRhd2FpdCBjcmVhdGVYcEdyYW50KGdyYW50LCB7IHNraXBPZmZsaW5lUXVldWU6IHRydWUgfSk7XG5cdFx0XHRjb25zb2xlLmxvZygnW1hQXSBGbHVzaGVkIHF1ZXVlZCBncmFudCcsIGdyYW50LmRlZHVwZUtleSk7XG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0Y29uc29sZS53YXJuKCdbWFBdIEZhaWxlZCB0byBmbHVzaCBxdWV1ZWQgZ3JhbnQsIGtlZXBpbmcgaW4gcXVldWUnLCBncmFudC5kZWR1cGVLZXksIGUpO1xuXHRcdFx0cmVtYWluaW5nLnB1c2goZ3JhbnQpO1xuXHRcdH1cblx0fVxuXHR3cml0ZVF1ZXVlKHJlbWFpbmluZyk7XG59O1xuXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsICgpID0+IHtcblx0XHRmbHVzaFF1ZXVlZEdyYW50cygpO1xuXHR9KTtcbn1cblxudHlwZSBDcmVhdGVPcHRpb25zID0geyBza2lwT2ZmbGluZVF1ZXVlPzogYm9vbGVhbiB9O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlWHBHcmFudCA9IGFzeW5jIChcblx0cGFydGlhbDogT21pdDxYcEdyYW50UmVjb3JkLCAndXNlcklkJyB8ICdjcmVhdGVkQXQnIHwgJ2RlZHVwZUtleScgfCAnbG9jYWxEYXRlS2V5Jz4gJiB7XG5cdFx0Ly8gYWxsb3cgY2FsbGVyIHRvIHBhc3MgY3VzdG9tIGtleXMgaWYgbmVjZXNzYXJ5XG5cdFx0bG9jYWxEYXRlS2V5Pzogc3RyaW5nO1xuXHRcdGRlZHVwZUtleT86IHN0cmluZztcblx0fVxuLCBvcHRpb25zOiBDcmVhdGVPcHRpb25zID0ge31cbik6IFByb21pc2U8eyBjcmVhdGVkOiBib29sZWFuOyBpZDogc3RyaW5nIH0+ID0+IHtcblx0Y29uc3QgdXNlcklkID0gZ2V0VXNlcklkT3JUaHJvdygpO1xuXHRjb25zdCBsb2NhbERhdGVLZXkgPSBwYXJ0aWFsLmxvY2FsRGF0ZUtleSB8fCBnZXRMb2NhbERhdGVLZXkoKTtcblx0Y29uc3QgZGVkdXBlS2V5ID0gcGFydGlhbC5kZWR1cGVLZXkgfHwgYnVpbGREZWR1cGVLZXkodXNlcklkLCBwYXJ0aWFsLnNvdXJjZVR5cGUsIHBhcnRpYWwuc291cmNlSWQsIGxvY2FsRGF0ZUtleSk7XG5cblx0Y29uc3QgZ3JhbnQ6IFhwR3JhbnRSZWNvcmQgPSB7XG5cdFx0dXNlcklkLFxuXHRcdHNvdXJjZVR5cGU6IHBhcnRpYWwuc291cmNlVHlwZSxcblx0XHRzb3VyY2VJZDogcGFydGlhbC5zb3VyY2VJZCxcblx0XHRhbW91bnQ6IE1hdGgubWF4KDAsIE1hdGguZmxvb3IocGFydGlhbC5hbW91bnQgfHwgMCkpLFxuXHRcdGxvY2FsRGF0ZUtleSxcblx0XHRkZWR1cGVLZXksXG5cdFx0Y3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcblx0fTtcblxuXHRpZiAoZ3JhbnQuYW1vdW50IDw9IDApIHRocm93IG5ldyBFcnJvcignW1hQXSBJbnZhbGlkIGdyYW50IGFtb3VudCcpO1xuXG5cdGNvbnN0IGNvbCA9IGNvbGxlY3Rpb24oZGIsICdnYW1lUHJvZ3Jlc3MnLCB1c2VySWQsICd4cEdyYW50cycpO1xuXHRjb25zdCByZWYgPSBkb2MoY29sLCBkZWR1cGVLZXkpO1xuXG5cdHRyeSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0eCkgPT4ge1xuXHRcdFx0Y29uc3Qgc25hcCA9IGF3YWl0IHR4LmdldChyZWYpO1xuXHRcdFx0aWYgKHNuYXAuZXhpc3RzKCkpIHtcblx0XHRcdFx0cmV0dXJuIHsgY3JlYXRlZDogZmFsc2UgfTtcblx0XHRcdH1cblx0XHRcdHR4LnNldChyZWYsIGdyYW50KTtcblx0XHRcdHJldHVybiB7IGNyZWF0ZWQ6IHRydWUgfTtcblx0XHR9KTtcblx0XHRjb25zb2xlLmxvZygnW1hQXSBHcmFudCBwZXJzaXN0ZWQnLCB7IGRlZHVwZUtleSwgc291cmNlVHlwZTogZ3JhbnQuc291cmNlVHlwZSwgYW1vdW50OiBncmFudC5hbW91bnQgfSk7XG5cdFx0cmV0dXJuIHsgY3JlYXRlZDogcmVzdWx0LmNyZWF0ZWQsIGlkOiBkZWR1cGVLZXkgfTtcblx0fSBjYXRjaCAoZXJyOiBhbnkpIHtcblx0XHQvLyBPZmZsaW5lIG9yIG90aGVyIGVycm9yOiBvcHRpb25hbGx5IHF1ZXVlXG5cdFx0aWYgKCFvcHRpb25zLnNraXBPZmZsaW5lUXVldWUgJiYgdHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgIW5hdmlnYXRvci5vbkxpbmUpIHtcblx0XHRcdGVucXVldWVHcmFudChncmFudCk7XG5cdFx0XHRjb25zb2xlLndhcm4oJ1tYUF0gT2ZmbGluZSwgcXVldWVkIGdyYW50JywgZGVkdXBlS2V5KTtcblx0XHRcdHRocm93IG5ldyBFcnJvcignW1hQXSBRdWV1ZWQgKG9mZmxpbmUpJyk7XG5cdFx0fVxuXHRcdHRocm93IGVycjtcblx0fVxufTtcblxuZXhwb3J0IGNvbnN0IGJ1aWxkRGVkdXBlS2V5ID0gKHVzZXJJZDogc3RyaW5nLCBzb3VyY2VUeXBlOiBYcFNvdXJjZVR5cGUsIHNvdXJjZUlkOiBzdHJpbmcsIGxvY2FsRGF0ZUtleT86IHN0cmluZyk6IHN0cmluZyA9PiB7XG5cdC8vIFF1ZXN0cyBzaG91bGQgYmUgaWRlbXBvdGVudCBwZXIgZGF5LCBsZXZlbHMgc2hvdWxkIGJlIGlkZW1wb3RlbnQgZm9yZXZlclxuXHRpZiAoc291cmNlVHlwZSA9PT0gJ3F1ZXN0Jykge1xuXHRcdHJldHVybiBgJHt1c2VySWR9OnF1ZXN0OiR7c291cmNlSWR9OiR7bG9jYWxEYXRlS2V5IHx8IGdldExvY2FsRGF0ZUtleSgpfWA7XG5cdH1cblx0cmV0dXJuIGAke3VzZXJJZH06bGV2ZWw6JHtzb3VyY2VJZH1gO1xufTtcblxuZXhwb3J0IGludGVyZmFjZSBYcFN1bW1hcnkge1xuXHRsaWZldGltZVRvdGFsOiBudW1iZXI7XG5cdHRvZGF5UXVlc3RUb3RhbDogbnVtYmVyO1xuXHRncmFudHM6IFhwR3JhbnRSZWNvcmRbXTtcbn1cblxuZXhwb3J0IGNvbnN0IHN1YnNjcmliZVRvWHAgPSAoXG5cdG9uQ2hhbmdlOiAoc3VtbWFyeTogWHBTdW1tYXJ5KSA9PiB2b2lkXG4pID0+IHtcblx0Y29uc3QgdXNlcklkID0gZ2V0VXNlcklkT3JUaHJvdygpO1xuXHRjb25zdCBjb2wgPSBjb2xsZWN0aW9uKGRiLCAnZ2FtZVByb2dyZXNzJywgdXNlcklkLCAneHBHcmFudHMnKTtcblx0Y29uc3QgcUFsbCA9IHF1ZXJ5KGNvbCwgb3JkZXJCeSgnY3JlYXRlZEF0JywgJ2Rlc2MnKSk7XG5cdHJldHVybiBvblNuYXBzaG90KHFBbGwsIChzbmFwKSA9PiB7XG5cdFx0bGV0IGxpZmV0aW1lVG90YWwgPSAwO1xuXHRcdGxldCB0b2RheVF1ZXN0VG90YWwgPSAwO1xuXHRcdGNvbnN0IHRvZGF5S2V5ID0gZ2V0TG9jYWxEYXRlS2V5KCk7XG5cdFx0Y29uc3QgZ3JhbnRzOiBYcEdyYW50UmVjb3JkW10gPSBbXTtcblx0XHRzbmFwLmZvckVhY2goKGQpID0+IHtcblx0XHRcdGNvbnN0IGRhdGEgPSBkLmRhdGEoKSBhcyBhbnk7XG5cdFx0XHRjb25zdCByZWM6IFhwR3JhbnRSZWNvcmQgPSB7XG5cdFx0XHRcdHVzZXJJZDogZGF0YS51c2VySWQsXG5cdFx0XHRcdHNvdXJjZVR5cGU6IGRhdGEuc291cmNlVHlwZSxcblx0XHRcdFx0c291cmNlSWQ6IGRhdGEuc291cmNlSWQsXG5cdFx0XHRcdGFtb3VudDogZGF0YS5hbW91bnQsXG5cdFx0XHRcdGxvY2FsRGF0ZUtleTogZGF0YS5sb2NhbERhdGVLZXksXG5cdFx0XHRcdGRlZHVwZUtleTogZGF0YS5kZWR1cGVLZXkgfHwgZC5pZCxcblx0XHRcdFx0Y3JlYXRlZEF0OiBkYXRhLmNyZWF0ZWRBdFxuXHRcdFx0fTtcblx0XHRcdGdyYW50cy5wdXNoKHJlYyk7XG5cdFx0XHRsaWZldGltZVRvdGFsICs9IHJlYy5hbW91bnQ7XG5cdFx0XHRpZiAocmVjLnNvdXJjZVR5cGUgPT09ICdxdWVzdCcgJiYgcmVjLmxvY2FsRGF0ZUtleSA9PT0gdG9kYXlLZXkpIHtcblx0XHRcdFx0dG9kYXlRdWVzdFRvdGFsICs9IHJlYy5hbW91bnQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0b25DaGFuZ2UoeyBsaWZldGltZVRvdGFsLCB0b2RheVF1ZXN0VG90YWwsIGdyYW50cyB9KTtcblx0fSk7XG59O1xuXG5cbiJdLCJuYW1lcyI6WyJkYiIsImF1dGgiLCJjb2xsZWN0aW9uIiwiZG9jIiwib25TbmFwc2hvdCIsInF1ZXJ5IiwicnVuVHJhbnNhY3Rpb24iLCJvcmRlckJ5IiwiZ2V0VXNlcklkT3JUaHJvdyIsInVzZXIiLCJjdXJyZW50VXNlciIsIkVycm9yIiwidWlkIiwiZ2V0TG9jYWxEYXRlS2V5Iiwibm93IiwiRGF0ZSIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoIiwiU3RyaW5nIiwiZ2V0TW9udGgiLCJwYWRTdGFydCIsImRheSIsImdldERhdGUiLCJRVUVVRV9LRVkiLCJyZWFkUXVldWUiLCJyYXciLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiSlNPTiIsInBhcnNlIiwid3JpdGVRdWV1ZSIsIml0ZW1zIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImVucXVldWVHcmFudCIsImdyYW50IiwicSIsInB1c2giLCJmbHVzaFF1ZXVlZEdyYW50cyIsImxlbmd0aCIsInJlbWFpbmluZyIsImNyZWF0ZVhwR3JhbnQiLCJza2lwT2ZmbGluZVF1ZXVlIiwiY29uc29sZSIsImxvZyIsImRlZHVwZUtleSIsImUiLCJ3YXJuIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsInBhcnRpYWwiLCJvcHRpb25zIiwidXNlcklkIiwibG9jYWxEYXRlS2V5IiwiYnVpbGREZWR1cGVLZXkiLCJzb3VyY2VUeXBlIiwic291cmNlSWQiLCJhbW91bnQiLCJNYXRoIiwibWF4IiwiZmxvb3IiLCJjcmVhdGVkQXQiLCJ0b0lTT1N0cmluZyIsImNvbCIsInJlZiIsInJlc3VsdCIsInR4Iiwic25hcCIsImdldCIsImV4aXN0cyIsImNyZWF0ZWQiLCJzZXQiLCJpZCIsImVyciIsIm5hdmlnYXRvciIsIm9uTGluZSIsInN1YnNjcmliZVRvWHAiLCJvbkNoYW5nZSIsInFBbGwiLCJsaWZldGltZVRvdGFsIiwidG9kYXlRdWVzdFRvdGFsIiwidG9kYXlLZXkiLCJncmFudHMiLCJmb3JFYWNoIiwiZCIsImRhdGEiLCJyZWMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./src/services/user/xpGrants.ts\n");

/***/ })

};
;